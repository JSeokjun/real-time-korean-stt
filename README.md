# 실시간 한국어 음성 인식 (STT) 모듈

이 프로젝트는 OpenAI의 `Whisper`를 사용하여 마이크로부터 실시간 음성 입력을 받아 한국어 텍스트로 변환하는 기능을 제공합니다.
**`noisereduce`를 통한 배경 소음 제거**와 **`Silero VAD`를 통한 지능형 음성 감지 기능**이 포함되어, '쿵' 소리나 '달그락' 거리는 소리 등 불규칙한 비음성 소음을 효과적으로 필터링하고 시끄러운 환경에서도 인식 정확도를 크게 향상시켰습니다.

## 주요 기능

-   **지능형 음성 감지 (VAD)**: `Silero VAD` 딥러닝 모델을 사용하여, 단순 소리 크기가 아닌 음성의 패턴을 분석합니다. 이를 통해 말소리와 순간적인 소음(충격음, 기침 등)을 구분하여, 사람의 목소리가 있을 때만 녹음을 시작합니다.
-   **실시간 배경 소음 제거**: 프로그램 시작 시 주변의 꾸준한 소음(팬 소리, 에어컨 소리 등)을 학습하여, 이후 입력되는 모든 오디오의 배경 소음을 실시간으로 억제합니다.
-   **자동 파일 저장**: 일정 시간(10초) 동안 추가 음성 입력이 없으면, 인식된 전체 텍스트를 자동으로 `transcripts/` 디렉토리에 `.txt` 파일로 저장합니다.
-   **LLM 분석 기능**: Gemma 모델을 사용하여 인식된 텍스트를 분석하고, 안내방송의 핵심 정보를 추출하여 `results/` 디렉토리에 `.json` 파일로 저장합니다.
-   **간편한 설정**: 스크립트 내의 상수 값을 변경하여 음성 감지 민감도, 소음 학습 시간 등을 쉽게 조절할 수 있습니다.

## 요구사항

-   Python 3.10+
-   macOS (PyAudio 호환 환경)
-   `portaudio` 라이브러리

## 설치 방법

1.  **PortAudio 설치 (macOS의 경우)**

    Homebrew를 사용하여 `portaudio`를 설치합니다. 이 라이브러리는 마이크 입력을 처리하는 `pyaudio`에 필요합니다.
    ```bash
    brew install portaudio
    ```

2.  **종속성 설치**

    필요한 Python 라이브러리들을 설치합니다.
    ```bash
    pip install -r requirements.txt
    ```

3.  **모델 다운로드**

    이 프로젝트는 OpenAI의 `Whisper`를 사용합니다. 
    Hugging Face Hub로부터 원하는 모델 파일을 다운로드하여 `models/` 디렉토리 안에 저장하세요.

    프로젝트에 사용한 모델의 예시는 다음과 같습니다.
    - `openai/whisper-large-v3-turbo`
    - `o0dimplz0o/Whisper-Large-v3-turbo-STT-Zeroth-KO-v2`
    - `openai/whisper-small-ko`

## 사용 방법

아래 명령어를 실행하여 실시간 음성 인식을 시작합니다.

```bash
python src/stt_module.py
```

-   프로그램이 실행되면 **"n초간 주변 소음을 학습합니다. 조용히 해주세요..."** 라는 메시지가 나타납니다. 설정된 시간 동안 주변 환경을 조용히 유지해주세요.
-   소음 학습 및 VAD 모델 로딩이 완료되면 실시간 음성 인식이 시작됩니다.
-   음성이 감지되면 녹음이 시작되고, 발화가 끝나면 인식된 텍스트가 콘솔에 출력됩니다.
-   마지막 발화 후 10초가 지나면 전체 대화 내용이 `transcripts/transcript_YYYYMMDD_HHMMSS.txt` 형식의 파일로 저장되고, LLM 모델이 있을 경우 분석 결과가 `results/result_YYYYMMDD_HHMMSS.json` 형식으로 저장됩니다.
-   `Ctrl+C`를 눌러 프로그램을 종료할 수 있습니다.

## 주요 설정값

`src/stt_module.py` 파일 상단에서 다음 값들을 조절하여 성능을 튜닝할 수 있습니다.

-   `VAD_THRESHOLD`: VAD 모델이 음성이라고 판단할 확률의 임계값입니다. (0~1 사이, 기본값: 0.3) 값이 높을수록 명확한 목소리에만 반응합니다.
-   `NOISE_LEARNING_DURATION`: 프로그램 시작 시 배경 소음을 학습할 시간(초)입니다. (기본값: 5)
-   `SPEECH_END_THRESHOLD`: 발화가 끝났다고 판단하기까지 기다리는 침묵 시간(초)입니다. 말이 자주 끊기는 현상이 발생하면 이 값을 늘려보세요. (기본값: 3)
-   `PAUSE_DURATION`: 대화가 끝났다고 판단하는 침묵 시간(초)입니다. 이 시간이 지나면 자동으로 파일을 저장합니다. (기본값: 10)